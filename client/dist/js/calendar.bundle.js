!function(){"use strict";var e,t={667:function(e,t,n){var i=n(19),a=n.n(i);class o{constructor(e,t={}){this.container=e,this.options={initialView:"dayGridMonth",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,listWeek"},eventDisplay:"block",dayMaxEvents:3,moreLinkClick:"popover",eventClick:this.handleEventClick.bind(this),eventDidMount:this.styleEvent.bind(this),loading:this.handleLoading.bind(this),...t},this.calendar=null,this.eventCache=new Map,this.init()}async init(){try{const{Calendar:e}=await n.e(96).then(n.bind(n,363)),t=await n.e(96).then(n.bind(n,950)),i=await n.e(96).then(n.bind(n,666)),a=await n.e(96).then(n.bind(n,41)),o=await n.e(96).then(n.bind(n,680));this.calendar=new e(this.container,{...this.options,plugins:[t.default,i.default,a.default,o.default],events:this.loadEvents.bind(this)}),this.calendar.render(),this.bindCustomEvents()}catch(e){console.error("Failed to initialize FullCalendar:",e),this.showFallbackView()}}async loadEvents(e,t,n){try{const n=await fetch(this.buildEventUrl(e.start,e.end));if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const i=await n.json();i.forEach(e=>{this.eventCache.set(e.id,e)}),t(this.transformEvents(i))}catch(e){console.error("Failed to load events:",e),n(e)}}buildEventUrl(e,t){const n=new URLSearchParams({start:e.toISOString().split("T")[0],end:t.toISOString().split("T")[0],format:"json"});return`${window.location.pathname}events?${n.toString()}`}transformEvents(e){return e.map(e=>({id:e.ID,title:e.Title,start:e.AllDay?e.StartDate:`${e.StartDate}T${e.StartTime}`,end:e.AllDay?null:`${e.EndDate}T${e.EndTime}`,allDay:e.AllDay,url:e.Link,className:this.getEventClasses(e),extendedProps:{description:e.Content,location:e.Location,category:e.Category,isRecurring:e.IsRecurring,originalEvent:e}}))}getEventClasses(e){const t=["calendar-event"];return e.AllDay&&t.push("all-day-event"),e.IsRecurring&&t.push("recurring-event"),e.Category&&t.push(`category-${e.Category.toLowerCase().replace(/\s+/g,"-")}`),t.join(" ")}styleEvent(e){const t=e.event,n=e.el;n.classList.add("border-0","rounded");const i=t.extendedProps.category;if(i){const e=`bg-${this.getCategoryColor(i)}`;n.classList.add(e)}n.setAttribute("role","button"),n.setAttribute("tabindex","0"),n.setAttribute("aria-label",`Event: ${t.title}`),t.extendedProps.description&&(n.setAttribute("title",this.stripHtml(t.extendedProps.description)),n.setAttribute("data-bs-toggle","tooltip"),n.setAttribute("data-bs-placement","top"))}getCategoryColor(e){return{service:"primary",meeting:"secondary",study:"info",fellowship:"success",outreach:"warning",special:"danger",youth:"light",children:"dark"}[e.toLowerCase().replace(/\s+/g,"")]||"secondary"}handleEventClick(e){e.jsEvent.preventDefault();const t=e.event;this.container.dispatchEvent(new CustomEvent("calendar:eventClick",{detail:{event:t,originalEvent:t.extendedProps.originalEvent,jsEvent:e.jsEvent}})),t.url&&this.showEventModal(t)}showEventModal(e){const t=`\n      <div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">\n        <div class="modal-dialog">\n          <div class="modal-content">\n            <div class="modal-header">\n              <h5 class="modal-title" id="eventModalLabel">${e.title}</h5>\n              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n            </div>\n            <div class="modal-body">\n              <div class="event-details">\n                ${this.renderEventDetails(e)}\n              </div>\n            </div>\n            <div class="modal-footer">\n              <a href="${e.url}" class="btn btn-primary">View Full Details</a>\n              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    `,n=document.getElementById("eventModal");n&&n.remove(),document.body.insertAdjacentHTML("beforeend",t),new bootstrap.Modal(document.getElementById("eventModal")).show()}renderEventDetails(e){const t=e.extendedProps;let n="";return n+=`<p><strong>Date:</strong> ${this.formatEventDate(e)}</p>`,t.location&&(n+=`<p><strong>Location:</strong> ${t.location}</p>`),t.category&&(n+=`<p><strong>Category:</strong> ${t.category}</p>`),t.description&&(n+=`<div><strong>Description:</strong><div class="mt-2">${t.description}</div></div>`),n}formatEventDate(e){const t=new Date(e.start),n=e.end?new Date(e.end):null;if(e.allDay)return n&&t.toDateString()!==n.toDateString()?`${t.toLocaleDateString()} - ${n.toLocaleDateString()}`:t.toLocaleDateString();{const e=t.toLocaleDateString(),i=t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return n?`${e} ${i} - ${n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:`${e} ${i}`}}handleLoading(e){const t=this.container.querySelector(".calendar-loading");t&&(t.style.display=e?"block":"none"),this.container.dispatchEvent(new CustomEvent("calendar:loading",{detail:{isLoading:e}}))}bindCustomEvents(){document.addEventListener("calendar:filter",e=>{this.applyFilters(e.detail.filters)}),document.addEventListener("calendar:changeView",e=>{this.calendar&&this.calendar.changeView(e.detail.view)}),document.addEventListener("calendar:navigate",e=>{if(this.calendar){const{direction:t,date:n}=e.detail;n?this.calendar.gotoDate(n):"prev"===t?this.calendar.prev():"next"===t?this.calendar.next():"today"===t&&this.calendar.today()}})}applyFilters(e){this.calendar&&this.calendar.refetchEvents()}showFallbackView(){this.container.innerHTML=`\n      <div class="alert alert-warning">\n        <h5>Calendar View Unavailable</h5>\n        <p>The calendar view could not be loaded. Please refresh the page or try again later.</p>\n        <a href="${window.location.pathname}?view=list" class="btn btn-primary">View Events List</a>\n      </div>\n    `}stripHtml(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}getCalendar(){return this.calendar}refresh(){this.calendar&&this.calendar.refetchEvents()}destroy(){this.calendar&&this.calendar.destroy()}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".fullcalendar-view").forEach(e=>{e.dataset.initialized||(new o(e),e.dataset.initialized="true")})}),new class{constructor(){this.init()}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.initializeComponents()):this.initializeComponents()}initializeComponents(){console.log("Initializing Dynamic Calendar Module...");const e=document.querySelector("#dynamic-calendar-container");e&&(this.calendarView=new CalendarView(e));const t=document.querySelector(".calendar-list-view");t&&this.initializeListView(t);const n=document.querySelector(".calendar-filter-form");n&&(this.smartFiltering=new SmartFiltering(n),this.initializeChoicesJS(n)),this.keyboardNavigation=new KeyboardNavigation,this.isTouchDevice()&&(this.touchInteractions=new TouchInteractions),console.log("Calendar module initialized successfully")}initializeListView(e){e.classList.add("enhanced-list-view");const t=e.querySelectorAll("img[data-src]");t.length>0&&this.initializeLazyLoading(t),e.querySelectorAll(".pagination a").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),this.handlePaginationClick(e)})})}initializeLazyLoading(e){const t=new IntersectionObserver((e,n)=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target;n.src=n.dataset.src,n.classList.remove("lazy"),t.unobserve(n)}})});e.forEach(e=>t.observe(e))}async handlePaginationClick(e){const t=e.href;try{const e=await fetch(t,{headers:{"X-Requested-With":"XMLHttpRequest"}});if(e.ok){const n=await e.text();this.updateListContent(n),history.pushState(null,"",t)}}catch(e){console.error("Error loading page:",e),window.location.href=t}}initializeChoicesJS(e){e.querySelectorAll("select[multiple]").forEach(e=>{new(a())(e,{removeItemButton:!0,placeholder:!0,placeholderValue:"Select options...",searchEnabled:!0,searchPlaceholderValue:"Search...",shouldSort:!1,classNames:{containerOuter:"choices",containerInner:"choices__inner",input:"choices__input",inputCloned:"choices__input--cloned",list:"choices__list",listItems:"choices__list--multiple",listSingle:"choices__list--single",listDropdown:"choices__list--dropdown",item:"choices__item",itemSelectable:"choices__item--selectable",itemDisabled:"choices__item--disabled",itemChoice:"choices__item--choice",placeholder:"choices__placeholder",group:"choices__group",groupHeading:"choices__heading",button:"choices__button",activeState:"is-active",focusState:"is-focused",openState:"is-open",disabledState:"is-disabled",highlightedState:"is-highlighted",selectedState:"is-selected",flippedState:"is-flipped",loadingState:"is-loading"}})})}updateListContent(e){const t=(new DOMParser).parseFromString(e,"text/html").querySelector(".calendar-list-view"),n=document.querySelector(".calendar-list-view");t&&n&&(n.innerHTML=t.innerHTML,this.initializeListView(n))}isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0}}}},n={};function i(e){var a=n[e];if(void 0!==a)return a.exports;var o=n[e]={exports:{}};return t[e](o,o.exports,i),o.exports}i.m=t,e=[],i.O=function(t,n,a,o){if(!n){var r=1/0;for(c=0;c<e.length;c++){n=e[c][0],a=e[c][1],o=e[c][2];for(var s=!0,l=0;l<n.length;l++)(!1&o||r>=o)&&Object.keys(i.O).every(function(e){return i.O[e](n[l])})?n.splice(l--,1):(s=!1,o<r&&(r=o));if(s){e.splice(c--,1);var d=a();void 0!==d&&(t=d)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[n,a,o]},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.e=function(){return Promise.resolve()},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e={517:0};i.O.j=function(t){return 0===e[t]};var t=function(t,n){var a,o,r=n[0],s=n[1],l=n[2],d=0;if(r.some(function(t){return 0!==e[t]})){for(a in s)i.o(s,a)&&(i.m[a]=s[a]);if(l)var c=l(i)}for(t&&t(n);d<r.length;d++)o=r[d],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(c)},n=self.webpackChunksilverstripe_calendar_frontend=self.webpackChunksilverstripe_calendar_frontend||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var a=i.O(void 0,[96],function(){return i(667)});a=i.O(a)}();