!function(){"use strict";var e,t={987:function(e,t,n){var i=n(19),r=n.n(i),a=n(363),o=n(950),s=n(666),l=n(41),c=n(758),d=n(680);class u{constructor(e,t={}){this.element=e,this.config={...this.getConfigFromElement(),...t},this.options={plugins:[o.default,s.default,l.default,c.A,d.default],themeSystem:"bootstrap5",headerToolbar:this.getResponsiveHeaderToolbar(),initialView:this.config.defaultView||(window.innerWidth<768?"listWeek":"dayGridMonth"),height:"auto",aspectRatio:1.8,eventDisplay:"block",dayMaxEvents:!0,moreLinkClick:"popover",windowResizeDelay:150},this.init()}init(){const e={...this.options,events:(e,t,n)=>{this.fetchEvents(e,t,n)},eventClick:e=>this.handleEventClick(e),dateClick:e=>this.handleDateClick(e),eventDidMount:e=>this.handleEventDidMount(e)};this.calendar=new a.Calendar(this.element,e),this.calendar.render(),this.initializeMobileOptimizations()}getConfigFromElement(){const e={};return this.element.dataset.calendarId&&(e.calendarId=this.element.dataset.calendarId),this.element.dataset.defaultView&&(e.initialView=this.element.dataset.defaultView),this.element.dataset.eventsUrl&&(e.eventsUrl=this.element.dataset.eventsUrl),e}async fetchEvents(e,t,n){const i=this.config.eventsUrl;if(!i)return console.error("Events URL not configured"),void n(new Error("Events URL not configured"));const r=new URLSearchParams({start:e.startStr,end:e.endStr,format:"json"}),a=this.getActiveFilters();Object.entries(a).forEach(([e,t])=>{t&&"action_doFilter"!==e&&r.append(e,t)});try{const e=await fetch(`${i}?${r.toString()}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const a=await e.json();console.log("Fetched events:",a),Array.isArray(a)?t(a):(console.error("Expected array of events, got:",a),n(new Error("Invalid events format")))}catch(e){console.error("Error fetching events:",e),n(e)}}transformEvents(e){return e.map(e=>({id:e.ID,title:e.Title,start:e.StartDate+(e.StartTime?"T"+e.StartTime:""),end:e.EndDate&&e.EndTime?e.EndDate+"T"+e.EndTime:null,allDay:e.AllDay||!e.StartTime&&!e.EndTime,url:e.Link,extendedProps:{summary:e.Summary,categories:e.Categories,isRecurring:"NONE"!==e.Recursion},backgroundColor:this.getCategoryColor(e.Categories),borderColor:this.getCategoryColor(e.Categories)}))}getCategoryColor(e){return e&&0!==e.length&&{worship:"#0d6efd",education:"#198754",fellowship:"#fd7e14",service:"#dc3545",music:"#6f42c1",youth:"#20c997"}[e[0].Title.toLowerCase()]||"#6c757d"}getActiveFilters(){const e={},t=document.querySelector("#CalendarFilterForm_FilterForm");if(t){const n=new FormData(t);for(let[t,i]of n.entries())e[t]=i}return e}handleEventClick(e){e.jsEvent.preventDefault();const t=e.event;t.url?window.location.href=t.url:this.showEventPopup(t)}handleDateClick(e){console.log("Date clicked:",e.dateStr);const t=new URL(window.location);t.searchParams.set("date",e.dateStr),window.history.pushState({},"",t)}handleEventDidMount(e){const t=e.el;e.event.extendedProps.isRecurring&&(t.classList.add("recurring-event"),t.title="Recurring event"),e.event.extendedProps.summary&&(t.title=e.event.extendedProps.summary)}getResponsiveHeaderToolbar(){const e=window.innerWidth<768;return window.innerWidth>=768&&window.innerWidth,e?{left:"prev,next",center:"title",right:"dayGridMonth,timeGridWeek,listWeek"}:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,listWeek"}}initializeMobileOptimizations(){let e;window.addEventListener("resize",()=>{clearTimeout(e),e=setTimeout(()=>{this.calendar.updateSize(),this.calendar.setOption("headerToolbar",this.getResponsiveHeaderToolbar())},150)})}showEventPopup(e){const t=document.createElement("div");t.className="event-popup position-fixed",t.style.cssText="\n      top: 50%; left: 50%; transform: translate(-50%, -50%);\n      background: white; padding: 1rem; border-radius: 0.5rem;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1060;\n      max-width: 400px; width: 90%;\n    ",t.innerHTML=`\n      <div class="d-flex justify-content-between align-items-start mb-2">\n        <h5 class="mb-0">${e.title}</h5>\n        <button type="button" class="btn-close" onclick="this.closest('.event-popup').remove()"></button>\n      </div>\n      <p class="text-muted mb-2">\n        <i class="bi bi-calendar"></i> ${e.start.toLocaleDateString()}\n        ${e.start.toLocaleTimeString()}\n      </p>\n      ${e.extendedProps.summary?`<p>${e.extendedProps.summary}</p>`:""}\n    `,document.body.appendChild(t);const n=document.createElement("div");n.className="position-fixed",n.style.cssText="top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1059;",n.onclick=()=>{t.remove(),n.remove()},document.body.appendChild(n)}destroy(){this.calendar&&this.calendar.destroy()}}class h{constructor(e,t={}){this.container=e,this.options={initialView:"dayGridMonth",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,listWeek"},eventDisplay:"block",dayMaxEvents:3,moreLinkClick:"popover",eventClick:this.handleEventClick.bind(this),eventDidMount:this.styleEvent.bind(this),loading:this.handleLoading.bind(this),...t},this.calendar=null,this.eventCache=new Map,this.init()}async init(){try{const{Calendar:e}=await Promise.resolve().then(n.bind(n,363)),t=await Promise.resolve().then(n.bind(n,950)),i=await Promise.resolve().then(n.bind(n,666)),r=await Promise.resolve().then(n.bind(n,41)),a=await Promise.resolve().then(n.bind(n,680));this.calendar=new e(this.container,{...this.options,plugins:[t.default,i.default,r.default,a.default],events:this.loadEvents.bind(this)}),this.calendar.render(),this.bindCustomEvents()}catch(e){console.error("Failed to initialize FullCalendar:",e),this.showFallbackView()}}async loadEvents(e,t,n){try{const n=await fetch(this.buildEventUrl(e.start,e.end));if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const i=await n.json();i.forEach(e=>{this.eventCache.set(e.id,e)}),t(this.transformEvents(i))}catch(e){console.error("Failed to load events:",e),n(e)}}buildEventUrl(e,t){const n=new URLSearchParams({start:e.toISOString().split("T")[0],end:t.toISOString().split("T")[0],format:"json"});return`${window.location.pathname}events?${n.toString()}`}transformEvents(e){return e.map(e=>({id:e.ID,title:e.Title,start:e.AllDay?e.StartDate:`${e.StartDate}T${e.StartTime}`,end:e.AllDay?null:`${e.EndDate}T${e.EndTime}`,allDay:e.AllDay,url:e.Link,className:this.getEventClasses(e),extendedProps:{description:e.Content,location:e.Location,category:e.Category,isRecurring:e.IsRecurring,originalEvent:e}}))}getEventClasses(e){const t=["calendar-event"];return e.AllDay&&t.push("all-day-event"),e.IsRecurring&&t.push("recurring-event"),e.Category&&t.push(`category-${e.Category.toLowerCase().replace(/\s+/g,"-")}`),t.join(" ")}styleEvent(e){const t=e.event,n=e.el;n.classList.add("border-0","rounded");const i=t.extendedProps.category;if(i){const e=`bg-${this.getCategoryColor(i)}`;n.classList.add(e)}n.setAttribute("role","button"),n.setAttribute("tabindex","0"),n.setAttribute("aria-label",`Event: ${t.title}`),t.extendedProps.description&&(n.setAttribute("title",this.stripHtml(t.extendedProps.description)),n.setAttribute("data-bs-toggle","tooltip"),n.setAttribute("data-bs-placement","top"))}getCategoryColor(e){return{service:"primary",meeting:"secondary",study:"info",fellowship:"success",outreach:"warning",special:"danger",youth:"light",children:"dark"}[e.toLowerCase().replace(/\s+/g,"")]||"secondary"}handleEventClick(e){e.jsEvent.preventDefault();const t=e.event;this.container.dispatchEvent(new CustomEvent("calendar:eventClick",{detail:{event:t,originalEvent:t.extendedProps.originalEvent,jsEvent:e.jsEvent}})),t.url&&this.showEventModal(t)}showEventModal(e){const t=`\n      <div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">\n        <div class="modal-dialog">\n          <div class="modal-content">\n            <div class="modal-header">\n              <h5 class="modal-title" id="eventModalLabel">${e.title}</h5>\n              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n            </div>\n            <div class="modal-body">\n              <div class="event-details">\n                ${this.renderEventDetails(e)}\n              </div>\n            </div>\n            <div class="modal-footer">\n              <a href="${e.url}" class="btn btn-primary">View Full Details</a>\n              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    `,n=document.getElementById("eventModal");n&&n.remove(),document.body.insertAdjacentHTML("beforeend",t),new bootstrap.Modal(document.getElementById("eventModal")).show()}renderEventDetails(e){const t=e.extendedProps;let n="";return n+=`<p><strong>Date:</strong> ${this.formatEventDate(e)}</p>`,t.location&&(n+=`<p><strong>Location:</strong> ${t.location}</p>`),t.category&&(n+=`<p><strong>Category:</strong> ${t.category}</p>`),t.description&&(n+=`<div><strong>Description:</strong><div class="mt-2">${t.description}</div></div>`),n}formatEventDate(e){const t=new Date(e.start),n=e.end?new Date(e.end):null;if(e.allDay)return n&&t.toDateString()!==n.toDateString()?`${t.toLocaleDateString()} - ${n.toLocaleDateString()}`:t.toLocaleDateString();{const e=t.toLocaleDateString(),i=t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return n?`${e} ${i} - ${n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`:`${e} ${i}`}}handleLoading(e){const t=this.container.querySelector(".calendar-loading");t&&(t.style.display=e?"block":"none"),this.container.dispatchEvent(new CustomEvent("calendar:loading",{detail:{isLoading:e}}))}bindCustomEvents(){document.addEventListener("calendar:filter",e=>{this.applyFilters(e.detail.filters)}),document.addEventListener("calendar:changeView",e=>{this.calendar&&this.calendar.changeView(e.detail.view)}),document.addEventListener("calendar:navigate",e=>{if(this.calendar){const{direction:t,date:n}=e.detail;n?this.calendar.gotoDate(n):"prev"===t?this.calendar.prev():"next"===t?this.calendar.next():"today"===t&&this.calendar.today()}})}applyFilters(e){this.calendar&&this.calendar.refetchEvents()}showFallbackView(){this.container.innerHTML=`\n      <div class="alert alert-warning">\n        <h5>Calendar View Unavailable</h5>\n        <p>The calendar view could not be loaded. Please refresh the page or try again later.</p>\n        <a href="${window.location.pathname}?view=list" class="btn btn-primary">View Events List</a>\n      </div>\n    `}stripHtml(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}getCalendar(){return this.calendar}refresh(){this.calendar&&this.calendar.refetchEvents()}destroy(){this.calendar&&this.calendar.destroy()}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".fullcalendar-view").forEach(e=>{e.dataset.initialized||(new h(e),e.dataset.initialized="true")})});class v{constructor(){this.filterHistory=this.loadFilterHistory(),this.initPredictiveFilters(),this.initSavedFilters(),this.initAutoComplete()}initPredictiveFilters(){this.filterHistory&&this.filterHistory.length>0&&this.showFilterSuggestions(this.filterHistory)}initSavedFilters(){const e=this.loadSavedFilters();this.renderSavedFilters(e)}initAutoComplete(){const e=document.querySelector("#event-search");if(!e)return;let t;e.addEventListener("input",e=>{clearTimeout(t),t=setTimeout(()=>{this.performSearch(e.target.value)},300)})}performSearch(e){if(e.length<2)return;const t=this.generateSuggestions(e);this.showSearchSuggestions(t)}generateSuggestions(e){return[{title:"Christmas Service",date:"2025-12-25",type:"service"},{title:"Youth Group Meeting",date:"2025-07-30",type:"meeting"},{title:"Bible Study",date:"2025-07-31",type:"study"}].filter(t=>t.title.toLowerCase().includes(e.toLowerCase()))}showSearchSuggestions(e){const t=document.querySelector(".search-suggestions");t&&(0!==e.length?(t.innerHTML=e.map(e=>`\n      <div class="search-suggestion" data-id="${e.id}">\n        <div class="suggestion-title">${e.title}</div>\n        <div class="suggestion-meta">${e.date} • ${e.type}</div>\n      </div>\n    `).join(""),t.style.display="block"):t.style.display="none")}showFilterSuggestions(e){console.log("Showing filter suggestions based on history:",e)}loadFilterHistory(){try{return JSON.parse(localStorage.getItem("calendar-filter-history")||"[]")}catch(e){return[]}}loadSavedFilters(){try{return JSON.parse(localStorage.getItem("calendar-saved-filters")||"[]")}catch(e){return[]}}renderSavedFilters(e){console.log("Rendering saved filters:",e)}saveCurrentFilter(e,t){const n=this.loadSavedFilters();n.push({name:e,data:t,created:(new Date).toISOString()}),localStorage.setItem("calendar-saved-filters",JSON.stringify(n))}addToHistory(e){const t=this.loadFilterHistory();t.unshift(e);const n=t.slice(0,10);localStorage.setItem("calendar-filter-history",JSON.stringify(n))}}class f{constructor(){this.initSwipeNavigation(),this.initPullToRefresh(),this.initTouchOptimizations(),this.gestureThreshold=50}initSwipeNavigation(){let e,t,n;const i=document.querySelector(".calendar-container");i&&(i.addEventListener("touchstart",i=>{const r=i.touches[0];e=r.clientX,t=r.clientY,n=Date.now()},{passive:!0}),i.addEventListener("touchend",i=>{if(!e||!t)return;const r=i.changedTouches[0],a=r.clientX,o=r.clientY,s=Date.now(),l=a-e,c=o-t;s-n>300||(Math.abs(l)>Math.abs(c)&&Math.abs(l)>this.gestureThreshold&&(i.preventDefault(),l>0?(this.navigatePrevious(),this.showSwipeIndicator("right")):(this.navigateNext(),this.showSwipeIndicator("left"))),e=t=null)},{passive:!1}))}navigatePrevious(){const e=document.querySelector(".fc-prev-button");e&&!e.disabled&&e.click()}navigateNext(){const e=document.querySelector(".fc-next-button");e&&!e.disabled&&e.click()}showSwipeIndicator(e){const t=document.createElement("div");t.className=`swipe-indicator swipe-${e}`,t.innerHTML="left"===e?"→":"←",document.body.appendChild(t),setTimeout(()=>t.classList.add("show"),10),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>document.body.removeChild(t),300)},500)}initPullToRefresh(){let e=0,t=0,n=!1;const i=document.querySelector(".calendar-container");i&&(i.addEventListener("touchstart",t=>{0===i.scrollTop&&(e=t.touches[0].clientY)},{passive:!0}),i.addEventListener("touchmove",r=>{if(0===e)return;t=r.touches[0].clientY;const a=t-e;a>0&&0===i.scrollTop&&(n=!0,a>80?this.showPullRefreshIndicator(!0):this.showPullRefreshIndicator(!1))},{passive:!0}),i.addEventListener("touchend",()=>{n&&t-e>80&&this.performRefresh(),this.hidePullRefreshIndicator(),e=0,t=0,n=!1},{passive:!0}))}showPullRefreshIndicator(e){let t=document.querySelector(".pull-refresh-indicator");t||(t=document.createElement("div"),t.className="pull-refresh-indicator",t.innerHTML=`\n        <div class="spinner-border spinner-border-sm" role="status"></div>\n        <span>${e?"Release to refresh":"Pull to refresh"}</span>\n      `,document.body.appendChild(t)),t.classList.toggle("active",!0),t.querySelector("span").textContent=e?"Release to refresh":"Pull to refresh"}hidePullRefreshIndicator(){const e=document.querySelector(".pull-refresh-indicator");e&&e.classList.remove("active")}performRefresh(){console.log("Refreshing calendar data...");const e=document.querySelector(".pull-refresh-indicator");e&&(e.querySelector("span").textContent="Refreshing..."),setTimeout(()=>{this.hidePullRefreshIndicator(),this.showRefreshSuccess()},1e3)}showRefreshSuccess(){const e=document.createElement("div");e.className="toast align-items-center text-white bg-success border-0",e.innerHTML='\n      <div class="d-flex">\n        <div class="toast-body">Calendar refreshed!</div>\n      </div>\n    ',document.body.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},2e3)}initTouchOptimizations(){document.addEventListener("touchstart",()=>{},{passive:!0}),document.querySelectorAll(".event-card, .fc-event, .btn").forEach(e=>{e.style.touchAction="manipulation"}),document.querySelectorAll(".calendar-container, .event-list").forEach(e=>{e.style.webkitOverflowScrolling="touch"})}}class m{constructor(){this.initEventCardNavigation(),this.initCalendarNavigation(),this.initFilterNavigation(),this.initSkipLinks(),this.currentFocusIndex=0}initEventCardNavigation(){const e=document.querySelectorAll('.event-card[tabindex="0"]');e.forEach((t,n)=>{t.addEventListener("keydown",i=>{switch(i.key){case"Enter":case" ":i.preventDefault(),this.activateEvent(t);break;case"ArrowRight":case"ArrowDown":i.preventDefault(),this.focusNextCard(e,n);break;case"ArrowLeft":case"ArrowUp":i.preventDefault(),this.focusPrevCard(e,n);break;case"Home":i.preventDefault(),this.focusFirstCard(e);break;case"End":i.preventDefault(),this.focusLastCard(e);break;case"Escape":i.preventDefault(),this.clearFocus()}})})}initCalendarNavigation(){const e=document.querySelector(".fc");e&&(e.addEventListener("keydown",e=>{e.target.classList.contains("fc-daygrid-day")?this.handleDayNavigation(e):e.target.classList.contains("fc-event")&&this.handleEventNavigation(e)}),document.addEventListener("keydown",e=>{if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName)switch(e.key){case"n":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.navigateToToday());break;case"ArrowLeft":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.navigateToPrevious());break;case"ArrowRight":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.navigateToNext())}}))}handleDayNavigation(e){const t=e.target,n=Array.from(document.querySelectorAll(".fc-daygrid-day")),i=n.indexOf(t);switch(e.key){case"ArrowLeft":e.preventDefault(),this.focusDay(n,i-1);break;case"ArrowRight":e.preventDefault(),this.focusDay(n,i+1);break;case"ArrowUp":e.preventDefault(),this.focusDay(n,i-7);break;case"ArrowDown":e.preventDefault(),this.focusDay(n,i+7);break;case"Enter":case" ":e.preventDefault(),this.selectDay(t)}}handleEventNavigation(e){const t=e.target;switch(e.key){case"Enter":case" ":e.preventDefault(),this.activateCalendarEvent(t);break;case"Escape":e.preventDefault(),t.blur()}}initFilterNavigation(){if(!document.querySelector(".calendar-filters"))return;const e=document.querySelectorAll(".quick-filter");e.forEach((t,n)=>{t.addEventListener("keydown",t=>{switch(t.key){case"ArrowLeft":t.preventDefault(),this.focusQuickFilter(e,n-1);break;case"ArrowRight":t.preventDefault(),this.focusQuickFilter(e,n+1)}})})}initSkipLinks(){let e=document.querySelector(".skip-link");e||(e=document.createElement("a"),e.className="skip-link",e.href="#calendar-main",e.textContent="Skip to calendar content",document.body.insertBefore(e,document.body.firstChild));const t=document.querySelector(".calendar-container");t&&!t.id&&(t.id="calendar-main")}focusNextCard(e,t){const n=(t+1)%e.length;this.focusCard(e[n])}focusPrevCard(e,t){const n=0===t?e.length-1:t-1;this.focusCard(e[n])}focusFirstCard(e){e.length>0&&this.focusCard(e[0])}focusLastCard(e){e.length>0&&this.focusCard(e[e.length-1])}focusCard(e){e&&(e.focus(),this.announceToScreenReader(`Focused on event: ${this.getCardTitle(e)}`))}focusDay(e,t){t>=0&&t<e.length&&(e[t].focus(),this.announceToScreenReader(`Focused on ${this.getDayLabel(e[t])}`))}focusQuickFilter(e,t){t>=0&&t<e.length&&e[t].focus()}activateEvent(e){const t=e.querySelector("a");t?t.click():e.dispatchEvent(new CustomEvent("eventActivated",{detail:{card:e}}))}activateCalendarEvent(e){e.click()}selectDay(e){document.querySelectorAll(".fc-daygrid-day").forEach(e=>{e.removeAttribute("aria-selected")}),e.setAttribute("aria-selected","true"),this.announceToScreenReader(`Selected ${this.getDayLabel(e)}`)}navigateToToday(){const e=document.querySelector(".fc-today-button");e&&(e.click(),this.announceToScreenReader("Navigated to today"))}navigateToPrevious(){const e=document.querySelector(".fc-prev-button");e&&!e.disabled&&(e.click(),this.announceToScreenReader("Navigated to previous period"))}navigateToNext(){const e=document.querySelector(".fc-next-button");e&&!e.disabled&&(e.click(),this.announceToScreenReader("Navigated to next period"))}clearFocus(){document.activeElement?.blur()}getCardTitle(e){const t=e.querySelector(".event-title, .card-title, h1, h2, h3, h4, h5, h6");return t?t.textContent.trim():"Untitled event"}getDayLabel(e){const t=e.getAttribute("data-date");return t?new Date(t).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"Unknown date"}announceToScreenReader(e){let t=document.querySelector('.live-region[aria-live="polite"]');t||(t=document.createElement("div"),t.className="live-region",t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),document.body.appendChild(t)),t.textContent=e}}class g{constructor(){this.initCollapsibleFilters(),this.initActiveFilterTracking(),this.initKeyboardSupport(),this.initFilterMemory()}initCollapsibleFilters(){const e=document.querySelector(".calendar-filter-form");if(!e)return;const t=e.querySelector(".filter-header"),n=e.querySelector("#calendar-filters-content");t&&n&&(e.querySelector('.badge[aria-label="Active filters"]')&&(n.classList.add("show"),t.setAttribute("aria-expanded","true")),n.addEventListener("show.bs.collapse",()=>{t.setAttribute("aria-expanded","true"),this.focusFirstInput(n),this.trackFilterAction("expand")}),n.addEventListener("hide.bs.collapse",()=>{t.setAttribute("aria-expanded","false"),this.trackFilterAction("collapse")}))}initActiveFilterTracking(){const e=document.querySelector(".calendar-filter-form form");if(!e)return;let t=0;const n=new FormData(e);for(let[e,i]of n.entries())"SecurityID"!==e&&"action_doFilter"!==e&&i&&""!==i.trim()&&t++;const i=(e,i)=>{if("SecurityID"===e||"action_doFilter"===e)return;const r=i&&""!==i.trim(),a=""!==n.get(e)?.trim();r&&!a?t++:!r&&a&&t--,n.set(e,i),this.updateFilterBadge(t)};e.addEventListener("change",e=>{const{name:t,value:n}=e.target;i(t,n)}),e.addEventListener("input",this.debounce(e=>{const{name:t,value:n}=e.target;i(t,n)},300))}updateFilterBadge(e){const t=document.querySelector(".filter-header h5");if(!t)return;let n=t.querySelector(".badge");e>0?(n||(n=document.createElement("span"),n.className="badge bg-primary ms-2",n.setAttribute("aria-label","Active filters"),t.appendChild(n)),n.textContent=e):n&&n.remove()}initKeyboardSupport(){const e=document.querySelector(".filter-header");e&&(e.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.click())}),this.setupFormKeyboardNav())}setupFormKeyboardNav(){const e=document.querySelector(".calendar-filter-form form");if(!e)return;const t=e.querySelectorAll('input, select, button, [tabindex]:not([tabindex="-1"])');t.forEach((e,n)=>{e.addEventListener("keydown",e=>{if("ArrowDown"===e.key){e.preventDefault();const i=(n+1)%t.length;t[i].focus()}else if("ArrowUp"===e.key){e.preventDefault();const i=(n-1+t.length)%t.length;t[i].focus()}})})}initFilterMemory(){const e=document.querySelector(".calendar-filter-form form");e&&e.addEventListener("change",()=>{const t=new FormData(e),n={};for(let[e,i]of t.entries())"SecurityID"!==e&&"action_doFilter"!==e&&(n[e]=i);localStorage.setItem("calendar-filters",JSON.stringify(n))})}focusFirstInput(e){const t=e.querySelector("input, select");t&&setTimeout(()=>t.focus(),150)}trackFilterAction(e){"undefined"!=typeof gtag&&gtag("event","calendar_filter",{event_category:"engagement",event_label:e})}debounce(e,t){let n;return function(...i){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...i)},t)}}}document.addEventListener("DOMContentLoaded",()=>{new g});const p={initializeChoicesJS:function(){const e=document.querySelectorAll(".js-choice"),t=window.CalendarChoicesConfig||{};e.forEach(function(e){"SELECT"!==e.tagName||e.hasAttribute("data-choices-initialized")||(new(r())(e,t),e.setAttribute("data-choices-initialized","true"))})}};window.CalendarUtils=p,window.initializeChoicesJS=p.initializeChoicesJS,new class{constructor(){this.init()}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.initializeComponents()):this.initializeComponents()}initializeComponents(){console.log("Initializing Dynamic Calendar Module..."),this.initializeFullCalendar();const e=document.querySelector(".calendar-filter-form");e&&(this.smartFiltering=new v(e)),this.keyboardNavigation=new m,this.isTouchDevice()&&(this.touchInteractions=new f),console.log("Calendar module initialized successfully")}initializeFullCalendar(){const e=document.querySelector("#fullcalendar"),t=document.querySelector("#fullcalendar-view");if(!e||!t)return void console.warn("FullCalendar element not found");const n=t.dataset.eventsUrl,i=t.dataset.calendarId;console.log("Initializing FullCalendar with events URL:",n);try{this.calendarView=new u(e,{eventsUrl:n,calendarId:i}),console.log("FullCalendar initialized successfully")}catch(e){console.error("Failed to initialize FullCalendar:",e)}}fetchCalendarEvents(e,t,n,i){const r=document.querySelector('form[name="CalendarFilterForm"]'),a=new URLSearchParams;if(a.append("start",e.toISOString().split("T")[0]),a.append("end",t.toISOString().split("T")[0]),a.append("format","json"),r){const e=new FormData(r);for(const[t,n]of e.entries())n&&"action_doFilter"!==t&&a.append(t,n)}const o=`${new URL(window.location).pathname}?${a.toString()}`;fetch(o,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(e=>{if(!e.ok)throw new Error(`HTTP ${e.status}`);return e.json()}).then(e=>{console.log("Fetched calendar events:",e.length),n(e)}).catch(e=>{console.error("Failed to fetch calendar events:",e),i(e)})}isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0}}}},n={};function i(e){var r=n[e];if(void 0!==r)return r.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,i),a.exports}i.m=t,e=[],i.O=function(t,n,r,a){if(!n){var o=1/0;for(d=0;d<e.length;d++){n=e[d][0],r=e[d][1],a=e[d][2];for(var s=!0,l=0;l<n.length;l++)(!1&a||o>=a)&&Object.keys(i.O).every(function(e){return i.O[e](n[l])})?n.splice(l--,1):(s=!1,a<o&&(o=a));if(s){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[n,r,a]},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e={517:0};i.O.j=function(t){return 0===e[t]};var t=function(t,n){var r,a,o=n[0],s=n[1],l=n[2],c=0;if(o.some(function(t){return 0!==e[t]})){for(r in s)i.o(s,r)&&(i.m[r]=s[r]);if(l)var d=l(i)}for(t&&t(n);c<o.length;c++)a=o[c],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(d)},n=self.webpackChunksilverstripe_calendar_frontend=self.webpackChunksilverstripe_calendar_frontend||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var r=i.O(void 0,[96],function(){return i(987)});r=i.O(r)}();